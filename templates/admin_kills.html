<!-- admin_kills.html -->
{% extends "base.html" %}
{% block title %}Manage Kills - {{ room[1] }}{% endblock %}
{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="text-white mb-4">ðŸŽ¯ Kill Management - {{ room[1] }}</h2>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5>Room Details</h5>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Game:</strong> {{ room[2] }}</p>
                        <p><strong>Room ID:</strong> {{ room[6] }}</p>
                        <p><strong>Password:</strong> {{ room[7] }}</p>
                    </div>
                    <div class="col-md-6">
                        {% if room|length > 13 and room[13] %}
                        <div class="alert alert-info">
                            <strong>Kill Rewards Enabled</strong><br>
                            <strong>Min Kills Required:</strong> {{ room[14] }}<br>
                            <strong>Reward per Kill:</strong> {{ room[15] }} Rs
                        </div>
                        {% else %}
                        <div class="alert alert-secondary">
                            <strong>Kill Rewards:</strong> Disabled
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-primary">Back to Dashboard</a>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-4">Player Kill Records</h5>
                
                {% if players %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Team</th>
                                <th>Player</th>
                                <th>PUBG Username</th>
                                <th>Kills</th>
                                <th>Reward Earned</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for player in players %}
                            <tr>
                                <td>{{ player[3] }}</td>
                                <td>{{ player[1] }}</td>
                                <td>{{ player[2] }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if player[4] > 0 else 'secondary' }}">
                                        {{ player[4] }}
                                    </span>
                                </td>
                                <td>
                                    {% if player[5] > 0 %}
                                        <span class="text-success">{{ player[5] }} Rs</span>
                                    {% else %}
                                        <span class="text-muted">No reward</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if player[6] == 'approved' else 'warning' }}">
                                        {{ player[6] }}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary record-kills-btn" 
                                            data-user-id="{{ player[0] }}" 
                                            data-player-name="{{ player[1] }}" 
                                            data-current-kills="{{ player[4] }}"
                                            data-gaming-id="{{ player[8] if player[8] else '' }}">
                                        Update Kills
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <h5>No players enrolled yet!</h5>
                    <p>Players will appear here once they join teams for this tournament.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Record Kills Modal -->
<div class="modal fade" id="killsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="killsForm" method="POST" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title">Record Kills</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Player Name</label>
                        <input type="text" id="playerName" class="form-control" readonly>
                        <input type="hidden" name="user_id" id="userId">
                        <input type="hidden" name="gaming_id" id="gamingId">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Number of Kills</label>
                        <input type="number" name="kills_count" id="killsCount" class="form-control" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Screenshot Proof (Optional)</label>
                        <input type="file" name="screenshot" class="form-control" accept="image/*">
                        <small class="text-muted">Upload screenshot of kill count for verification</small>
                    </div>
                    {% if room|length > 13 and room[13] %}
                    <div class="alert alert-info">
                        <strong>Reward Calculation:</strong><br>
                        Minimum {{ room[14] }} kills required for rewards<br>
                        {{ room[15] }} Rs per kill above minimum
                    </div>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Record Kills</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.record-kills-btn');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;
            const playerName = this.dataset.playerName;
            const currentKills = this.dataset.currentKills;
            const gamingId = this.dataset.gamingId || '';
            
            document.getElementById('userId').value = userId;
            document.getElementById('playerName').value = playerName;
            document.getElementById('killsCount').value = currentKills;
            document.getElementById('gamingId').value = gamingId;
            
            const form = document.getElementById('killsForm');
            form.action = '/admin/record_kills/{{ room[0] }}';
            
            const modal = new bootstrap.Modal(document.getElementById('killsModal'));
            modal.show();
        });
    });
});
</script>
{% endblock %}